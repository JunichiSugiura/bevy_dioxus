<!DOCTYPE html>
<html lang="en">
    {% include "head.html" %}

    <body class="bg-background text-text">
        <div>
            {% include "header/index.html" %}
            {% include "header/menu.html" %}

            {% block breadcrumb %}
            {% endblock breadcrumb %}

            {% block content %}
                <ul class="flex justify-center">
                    <a href="{{ get_url(path = "@/docs/_index.md") }}" alt="Docs Page" class="underline text-accent">
                        <li>Docs</li>
                    </a>
                    <p class="px-4">/</p>
                    <a href="{{ get_url(path = "@/todo.md") }}" alt="Todo Page" class="underline text-accent">
                        <li>Todo</li>
                    </a>
                    <p class="px-4">/</p>
                    <a href="{{ get_url(path = "@/debug/_index.md") }}" alt="Debug Page (dev only)" class="underline text-accent">
                        <li>Debug</li>
                    </a>
                </li>
            {% endblock content %}
        </div>

        <script>
            const themes = ["light", "dark", "system"];

            applyTheme();

            // handlers
            function openMenu() {
                document.getElementById("menu").classList.replace("hidden", "flex");
            }

            function closeMenu() {
                document.getElementById("menu").classList.replace("flex", "hidden");
            }

            function openThemeSelector() {
                document.getElementById("theme-options").classList.replace("hidden", "flex");
            }

            function closeThemeSelector() {
                document.getElementById("theme-options").classList.replace("flex", "hidden");
            }

            function onSelectTheme(theme) {
                setTheme(theme);
                applyTheme();
                closeThemeSelector();
            }

            // utils
            function applyTheme() {
                updateThemeClass();
                updateSelectedTheme();
                updateThemeOptions();
            }

            function setTheme(theme) {
                switch (theme) {
                    case "light":
                    case "dark":
                        localStorage.setItem("theme", theme);
                        break;
                    case "system":
                        localStorage.removeItem("theme");
                        break;
                }
            }

            function updateThemeClass() {
                if (
                    localStorage.theme === "dark" || (
                        !("theme" in localStorage) &&
                        window.matchMedia("(prefers-color-scheme: dark)").matches)
                ) {
                    document.documentElement.classList.add("dark");
                } else {
                    document.documentElement.classList.remove("dark");
                }
            }

            function updateSelectedTheme() {
                hideElements();
                showElement();
            }

            function showElement() {
                const $el = document.getElementById(`theme-selected-${getTheme()}`);
                $el.classList.replace("hidden", "flex");
            }

            function hideElements($els) {
                themes
                    .filter(t => t !== getTheme())
                    .forEach(theme => {
                        const $el = document.getElementById(`theme-selected-${theme}`);
                        $el.classList.replace("flex", "hidden");
                    });
            }

            function updateThemeOptions() {
                removeAccents();
                addAccent();
            }

            function addAccent() {
                const [$icon, $text] = document.getElementById(`theme-options-${getTheme()}`).getElementsByTagName("div");
                $icon.classList.replace("text-neutral-600", "text-accent");
                $text.classList.replace("text-neutral-300", "text-accent");
            }

            function removeAccents() {
                themes
                    .filter(t => t !== getTheme())
                    .forEach(theme => {
                        const [$icon, $text] = document.getElementById(`theme-options-${theme}`).getElementsByTagName("div");
                        $icon.classList.replace("text-accent", "text-neutral-600");
                        $text.classList.replace("text-accent", "text-neutral-300");
                    });
            }

            function getTheme() {
                return localStorage.theme ?? "system";
            }
        </script>
    </body>
</html>
